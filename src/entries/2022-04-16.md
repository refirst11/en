---
title: 'Improving application quality with modern linting and formatting tools'
subtitle: 'Enhance Code Consistency, Readability, and Performance with husky, lint-staged, prettier, eslint, stylelint, commitlint'
date: '2022-04-16'
---

I wrote this in order to avoid stumbling at the beginning and make the process smoother.
[husky - npm](https://www.npmjs.com/package/husky)
[typicode / husky](https://github.com/typicode/husky)

```bash title="terminal/cmd"
npm set-script prepare "husky install"
npm run prepare
```

"set-script" adds "husky install" to the script in package.json, and creates a ".husky" folder at the root in "run prepare".

Next, create the "pre-commit.sh" file.

```bash title="terminal/cmd"
npx husky add .husky/pre-commit "npm run lint-staged"
git add .husky/pre-commit
```

If you proceed according to the GitHub Usage, files such as the following will be generated in the .husky folder and its sub folders:

```shell title="pre-commit.shell"
pre-commit.shell
#!/bin/sh
. "$(dirname "$0")/\_/husky.sh"

npm run lint-staged
```

Initially, it is set to "npm run test", but it will be rewritten here to trigger "staged".

```bash title="terminal/cmd"
npm install lint-staged
```

Write each lint triggered by lint-staged at the bottom of package.json (anywhere except for scripts).

```json title="package.json"
  "scripts": {
    "lint-staged": "lint-staged",
    "prepare": "husky install"
  },
"lint-staged": {
    "*.{js,ts,jsx,tsx}": "eslint --fix",
    "*.{css,scss}": "stylelint --fix"
}
```

I omitted prettier this time because it runs on save. Actually, I tried it, but since prettier is executed on all files, only lint-related tasks seem to be executed at commit time with lint-staged.

As a test, when committing a description that violates the syntax of lint, it returns an error correctly. The GUI of VSC also throws an error.

```json title=".stylelintrc.json"
{
  "plugins": ["stylelint-scss"],
  "extends": ["stylelint-config-recommended-scss", "stylelint-config-prettier"],

  "rules": {
    "color-named": null,
    "selector-class-pattern": null,
    "no-descending-specificity": null
  }
}
```

Here's an example of stylelint configuration. Since you need to spend some time setting rules, I think it's completely a matter of preference for small projects.

If you assign null to the error on the right side of stylelint error, you can ignore it.

stylelint-scss, stylelint-config-prettier, stylelint-config-recommended-scss, and stylelint-config-standard-scss are necessary for stylelint. From top to bottom: stylelint itself, necessary when used in combination with prettier like eslint, standard seems to have stricter rules than recommended. By the way, it seems that you can apply both at the same time.

The strictness of the rules is based on the following blog:

[Various things when introducing Stylelint](https://lab.astamuse.co.jp/entry/stylelint)

If you take care of style and ES, you should be almost okay.

<!-- ---
title: husky & lint-staged eslint stylelintの導入 - Next.js
subtitle: 立ち上げるときよく見る
date: '2022-04-16'
---

これを書くことになった動機としては最初にここでこけなければスムーズにいくなとおもうところです。
[husky - npm](https://www.npmjs.com/package/husky)
[typicode / husky](https://github.com/typicode/husky)

```bash title="terminal/cmd"
npm set-script prepare "husky install"
npm run prepare
```

set-script は package.json の script に husky install を追加し、run prepare の方でルートに.husky フォルダを作ります。

次に pre-commit.shel ファイルを作成していきます。

```bash title="terminal/cmd"
npx husky add .husky/pre-commit "npm run lint-staged"
git add .husky/pre-commit
```

こんな感じで GitHub の Usage 通りに進めると.husky フォルダと配下に以下のファイルが生成されます。

```shell title="pre-commit.shell"
pre-commit.shell
#!/bin/sh
. "$(dirname "$0")/\_/husky.sh"

npm run lint-staged
```

最初は npm run test になっていますがここでは staged を発火させるため書き換えます。

```bash
npm install lint-staged
```

package.json の一番下に(script 以外ならどこでもよい)lint-staged で発火させる各 lint を記述します。

```json title="package.json"
  "scripts": {
    "lint-staged": "lint-staged",
    "prepare": "husky install"
  },
"lint-staged": {
    "*.{js,ts,jsx,tsx}": "eslint --fix",
    "*.{css,scss}": "stylelint --fix"
}
```

今回は prettier はセーブ時に実行しているため省きました。
というか試したんですが prettier は全てのファイルに実行されるので lint-staged でコミット時に実行できるのは lint 系だけみたいです。

テストとして lint の構文に違反する記述をしてコミットするとしっかりとエラーを返してくれます。
VSC の GUI からもエラーを吐いてくれています。

```json title=".stylelintrc.json"
{
  "plugins": ["stylelint-scss"],
  "extends": ["stylelint-config-recommended-scss", "stylelint-config-prettier"],

  "rules": {
    "color-named": null,
    "selector-class-pattern": null,
    "no-descending-specificity": null
  }
}
```

stylelint の設定はこんな感じ、ルールを設定するために時間を多少使うことになるので小さいプロジェクトでは完全に好みだと思います。

stylelint エラーの右側のエラーに null を当ててあげれば無視することができます。

`stylelint-scss`

`stylelint-config-prettier`

`stylelint-config-recommended-scss`

`stylelint-config-standard-scss`

stylelint に必要な上記の説明を上から順に 、
stylelint 本体。
prettier との併用をする場合に eslint 同様必要。
recommended より standard の方がルールが厳格らしい。
ちなみに両方適用させておくみたいなこともできるみたいです。

ルールの厳格さは以下のブログを参考にした。

Stylelint を導入したときのあれこれ

Style と ES やっとけばほぼ大丈夫かなと思います。 -->
